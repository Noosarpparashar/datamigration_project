CREATE STORAGE INTEGRATION AWS_STORAGE_INT TYPE = EXTERNAL_STAGE STORAGE_PROVIDER = 'S3' ENABLED = TRUE STORAGE_AWS_ROLE_ARN = 'arn:aws:iam::557690586997:role/snowpipe_role' STORAGE_ALLOWED_LOCATIONS = ('s3://snowflake-youtube-chapter3');

DESC INTEGRATION AWS_STORAGE_INT;

CREATE STAGE MY_S3_STAGE
URL = 's3://snowflake-youtube-chapter3'
STORAGE_INTEGRATION = AWS_STORAGE_INT;


CREATE OR REPLACE PIPE MY_SNOWPIPE
AUTO_INGEST=TRUE
AS
COPY INTO MYDB.PUBLIC.FRAUD_DETECTION
FROM @MY_S3_STAGE
FILE_FORMAT = (TYPE = 'CSV' skip_header = 1);

SHOW PIPES;
DROP PIPE MY_SNOWPIPE

select COUNT(*) from MYDB.PUBLIC.FRAUD_DETECTION


select * from MYDB.PUBLIC.MY_S3_STAGE


LIST @MY_S3_STAGE;
REMOVE @MY_S3_STAGE;

SELECT $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15 FROM @MY_S3_STAGE;
ALTER PIPE MY_SNOWPIPE REFRESH;

